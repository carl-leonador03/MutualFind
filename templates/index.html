<!DOCTYPE html>
<html>
    <head>
        <title>MutualFind</title>
        <script type="text/javascript">
            var authWin;
            var authTimer;
            function openAuthWin() {
                authWin = window.open('{{ url_for("auth") }}', 'Authorize', 'width=616,height=770');
                authTimer = setInterval( function() {
                    if (authWin.closed) {
                        clearInterval(authTimer);
                        isAuthorized();
                    }
                },
                1000 );
            }

            function isAuthorized() {
                let result = document.cookie.split(";")[document.cookie.split(";").length - 1].split("=")[1];
                if (result != null) {
                    result = window.atob(result);
                    result = result.replaceAll("'", "\"");
                    let json_data = JSON.parse(result);
                    console.log(json_data);
                    return true;
                }
                else {
                    return false;
                }
                
            }

            function getCode(result) {
                let code = result.replace("b'", "").replace("'", "")
                document.cookie = "result=" + code;
                console.log(code);
            }

            /* function isAuthorized() {
                let result = window.atob(document.cookie.split(";")[document.cookie.split(";").length - 1].split("=")[1]);
                if (result != undefined) {
                    let user_guilds = fetch(
                        "https://discord.com/api/v10/users/@me/guilds",
                        {
                            method: "GET",
                            headers: {
                                "Authorization": result,
                                "Content-Type": "application/json"
                            }
                        }
                    ).then((response) => response.json())

                    let guild_select = document.getElementById("guild_select");

                    for (var guild of user_guilds) {
                        let guild_option = document.createElement("select");
                        guild_option.value = guild.id;
                        guild_option.text = 
                    }
                }
            } */
        </script>
    </head>
    <body>
        <button onClick="openAuthWin();">Authorize</button>
        <div id="guild_select_div">
            <select name="guilds" id="guild_select"></select>
        </div>
    </body>
</html>